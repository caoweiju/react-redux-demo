'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = reducer;

var _objectPathImmutable = require('object-path-immutable');

var _objectPathImmutable2 = _interopRequireDefault(_objectPathImmutable);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function reducer() {
    var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    var action = arguments[1];

    if (!action.meta || !action.meta.api) {
        return state;
    }

    var newState = state;
    var _action$meta = action.meta,
        type = _action$meta.type,
        name = _action$meta.name,
        params = _action$meta.params;

    var json = '{}';
    if (params) {
        json = JSON.stringify(params.placeholders);
    }
    var param = function param(_param) {
        return [name, json, _param];
    };

    switch (type) {
        case 'request':
            newState = _objectPathImmutable2.default.set(newState, param('isLoading'), true);
            newState = _objectPathImmutable2.default.set(newState, param('error'), null);

            return newState;
        case 'response':
            var _action$payload = action.payload,
                body = _action$payload.body,
                headers = _action$payload.headers,
                status = _action$payload.status;

            newState = _objectPathImmutable2.default.set(newState, param('isLoading'), false);
            newState = _objectPathImmutable2.default.set(newState, param('headers'), headers);
            newState = _objectPathImmutable2.default.set(newState, param('status'), status);

            if (body) {
                newState = _objectPathImmutable2.default.set(newState, param('result'), body);
            }

            return newState;
        case 'error':
            newState = _objectPathImmutable2.default.set(newState, param('isLoading'), false);
            newState = _objectPathImmutable2.default.set(newState, param('hasFailed'), true);
            newState = _objectPathImmutable2.default.set(newState, param('result'), null);

            if (action.payload instanceof Error) {
                var message = action.payload.message;
                newState = _objectPathImmutable2.default.set(newState, param('error'), message);
                newState = _objectPathImmutable2.default.del(newState, param('headers'));
                newState = _objectPathImmutable2.default.del(newState, param('status'));
            } else {
                var _action$payload2 = action.payload,
                    _body = _action$payload2.body,
                    _headers = _action$payload2.headers,
                    _status = _action$payload2.status;

                newState = _objectPathImmutable2.default.set(newState, param('error'), _body);
                newState = _objectPathImmutable2.default.set(newState, param('headers'), _headers);
                newState = _objectPathImmutable2.default.set(newState, param('status'), _status);
            }

            return newState;
        default:
            return state;
    }
}